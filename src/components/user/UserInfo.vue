<template>
    <div class="avatar item" @mouseover="isShow = true" @mouseleave="isShow = false" ref="user">
        <!-- <label> -->
        <img :src="userInfo.userAvatar" alt="avatar" @dblclick="changeAvatar">
        <input type="file" accept="image/*" id="avatar" style="display: none;" @change="fileChange($event)">
        <!-- </label> -->

        <transition name="animate__animated animate__bounce" enter-active-class="animate__fadeIn"
            leave-active-class="animate__fadeOut">
            <div class="user-informations" v-show="isShow">
                <div class="ninck item">
                    <h4>{{ userInfo.userName }}</h4>
                </div>
                <div class="user-level item cursor ">
                    <span :style="`background-color:${useUserLevelColor(userInfo.userLevel)}`">Lv.{{ userInfo.userLevel
                    }}</span>
                    <n-progress type="line" :percentage="20" :height="5" processing class="process" />
                    <span :style="`background-color:${useUserLevelColor(userInfo.userLevel + 1)}`">Lv.{{
                            userInfo.userLevel + 1
                    }}</span>
                </div>
                <div class="person-info item ">
                    <div>
                        <span>22</span>
                        <span class="cursor">关注</span>
                    </div>
                    <div>
                        <span>1</span>
                        <span class="cursor">粉丝</span>
                    </div>
                    <div>
                        <span>1</span>
                        <span class="cursor">动态</span>
                    </div>
                </div>
                <div class="application-class item ">
                    <div class="cursor" @click="gotoPersonalCenter">
                        <div class="inner">
                            <svg t="1665660429765" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" p-id="2577" width="32" height="32">
                                <path
                                    d="M665.69 554.94C736 506.25 782 425.11 782 333.22 782 184.3 661.12 63.56 512 63.56S242 184.3 242 333.22c0 91.89 46 173 116.31 221.72C222.74 614.14 128 749.27 128 906.5q0 6.27 0.21 12.48c0 1.41 0.09 2.82 0.15 4.22a40.05 40.05 0 0 0 79.93-3.64v-0.44c0-0.72-0.06-1.43-0.08-2.15-0.12-3.48-0.2-7-0.2-10.47 0-167.68 136.11-303.61 304-303.61S816 738.82 816 906.5c0 3.42-0.08 6.83-0.19 10.22 0 0.93-0.07 1.85-0.11 2.78a40.05 40.05 0 0 0 79.95 3.41c0.05-1.3 0.1-2.6 0.14-3.9q0.21-6.22 0.21-12.51c0-157.23-94.74-292.36-230.31-351.56zM322 333.22c0-104.8 85.07-189.76 190-189.76s190 85 190 189.76S616.93 523 512 523s-190-85-190-189.78z"
                                    fill="#cdcdcd" p-id="2578"></path>
                            </svg>
                            <span>个人中心</span>
                        </div>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>
                    <div class="cursor">
                        <div class="inner">
                            <svg t="1665660608810" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" p-id="10154" width="32" height="32">
                                <path
                                    d="M917.8 641.91l-0.4-1.57-0.6-1.51c-5.67-14.2-15.26-24.75-28.48-31.34l-0.88-0.43-21.78-8.71 2.15-22.68v-1.14c0-14-6.44-29.54-16.4-39.51l-0.65-0.61a240.34 240.34 0 0 0-98.62-55.84c-11.2-4.2-27.73-6.18-45.31 6.28l-25 14.3-19.2-13.55c-12.18-9-27.88-11.68-44.26-7.63l-0.92 0.23-0.91 0.3c-39.1 13-71.95 32.68-97.63 58.38-12.14 12.14-17.17 27.55-14.22 43.47l3.05 21.35L488 611l-0.46 0.23c-19 9.5-25.61 24.56-27.81 35.53l-0.47 2.34v1.27a36.6 36.6 0 0 0-1.73 7.51 247.72 247.72 0 0 0 4.36 102.8l0.29 1.13 0.39 1.09a57.29 57.29 0 0 0 29 32.21l0.78 0.38 21.65 8.69-2.19 23.1 0.05 1.55a58.59 58.59 0 0 0 15.9 38.17l1 1a240.58 240.58 0 0 0 96.64 55.34c7.24 3.76 14.56 3.76 17.45 3.76 7.52 0 14-1.7 20.27-3.35 1.35-0.35 2.77-0.73 4.27-1.1l4.84-1.2 21.89-16.73 17.27 12.19c12.22 9 27.95 11.7 44.34 7.59l0.88-0.23 0.86-0.28c39.05-13 71.89-32.65 97.63-58.36 12.11-12.11 17.15-27.51 14.23-43.44l-2.91-20.37 24.83-10.17 0.83-0.41c19-9.53 25.6-24.57 27.8-35.5l0.47-2.35v-1.79a28.49 28.49 0 0 0 1.68-6.89 248.25 248.25 0 0 0-4.23-102.8z m-43 94.44a35.42 35.42 0 0 0-2.36 10.87 9.39 9.39 0 0 1-1.23 0.8l-57.57 23.56 8.28 58 0.19 1.1a8.45 8.45 0 0 1-0.91 1.06c-20.48 20.46-46 35.65-77.83 46.42a8 8 0 0 1-3.56 0.11L693 845.18l-42 32.17c-2.21 0.58-4.62 1.22-6.32 1.55l-2.84-0.79a192.42 192.42 0 0 1-79.42-44.42 10.55 10.55 0 0 1-2.42-5.41l5.2-55.28-53.2-21.31a9.48 9.48 0 0 1-4-4.3 200 200 0 0 1-3-82.39v-0.2a36.94 36.94 0 0 0 2.12-9.45 9.22 9.22 0 0 1 1.63-1l51.4-24.34-8.14-57-0.18-1.1a8.17 8.17 0 0 1 0.93-1.08c20.41-20.44 45.86-35.63 77.76-46.41a8.25 8.25 0 0 1 3.6-0.1L679.09 556l54-30.85 1.19-0.89c0.33-0.25 0.61-0.45 0.85-0.6l2.76 0.77a192.58 192.58 0 0 1 79.73 44.71 12.42 12.42 0 0 1 2.15 4.86l-5.28 55.59 53.13 21.24a8.93 8.93 0 0 1 4.07 4.54 200.24 200.24 0 0 1 3.13 80.98z"
                                    fill="#cdcdcd" p-id="10155"></path>
                                <path
                                    d="M379.14 827.62a24 24 0 0 0 0-48H183.41c-21 0-38.15-17.67-38.15-39.38V184.4c0-21.72 17.11-39.38 38.15-39.38h602.3c21 0 38.15 17.66 38.15 39.38v269.48a24 24 0 0 0 48 0V184.4c0-48.18-38.65-87.38-86.15-87.38h-602.3c-47.51 0-86.15 39.2-86.15 87.38v555.84c0 48.18 38.64 87.38 86.15 87.38zM424.69 878.3H178.91a24 24 0 0 0 0 48h245.78a24 24 0 1 0 0-48z"
                                    fill="#cdcdcd" p-id="10156"></path>
                                <path
                                    d="M617.24 272.54a24 24 0 0 0-24-24H222.68a24 24 0 1 0 0 48h370.56a24 24 0 0 0 24-24zM493.52 426.14a24 24 0 0 0-24-24H222.68a24 24 0 1 0 0 48h246.84a24 24 0 0 0 24-24zM222.68 534.05a24 24 0 0 0 0 48H408a24 24 0 1 0 0-48zM689.84 612.66a88.57 88.57 0 1 0 88.57 88.56 88.66 88.66 0 0 0-88.57-88.56z m0 129.13a40.57 40.57 0 1 1 40.57-40.57 40.61 40.61 0 0 1-40.57 40.57z"
                                    fill="#cdcdcd" p-id="10157"></path>
                            </svg>
                            <span>投稿管理</span>
                        </div>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>
                    <div class="cursor">
                        <div class="inner">
                            <svg t="1665660659885" class="icon" viewBox="0 0 1627 1024" version="1.1"
                                xmlns="http://www.w3.org/2000/svg" p-id="12181" width="32" height="32">
                                <path
                                    d="M482.174757 1024c-25.564494 0-49.945446-10.888581-66.988442-29.825243l-1.420249-1.538604-1.183542-1.656957c-20.475266-30.298659-28.404993-68.053629-22.013869-104.033288l6.86454-229.370319-126.99399-161.079981c-25.327785-33.612575-34.085992-76.220065-23.907536-117.052242l0.591771-2.248729 0.946833-2.130374c15.14933-35.624595 46.394822-62.017568 83.913083-70.894129l73.971337-25.209431 142.143319-43.435969 107.347203-171.258437c19.055016-37.518262 56.809986-62.017568 98.944059-64.147943l2.01202-0.118354 2.012021 0.118354c40.240407 3.43227 76.338419 26.156264 96.932039 60.834027l130.781322 190.78687 193.390661 52.194175c25.682848 6.391123 47.341655 24.262598 58.111882 34.441054 10.533518 10.060102 28.760055 29.825243 32.192325 49.708738 7.101248 40.358761-5.207582 82.137772-33.139158 112.081368L1099.273232 684.678687l11.598705 208.895053-0.118354 1.42025c-2.01202 45.921405-15.386038 80.244105-39.885344 102.021267-18.108183 15.977809-41.542302 24.499307-67.816921 24.499306h-0.710125c-16.924642-0.355062-33.612575-3.313916-49.590384-8.87656l-0.710125-0.236709-212.800739-79.060564-186.289413 75.628295c-21.422099 8.758206-44.146093 13.847434-67.343505 14.912621h-0.236708c-1.065187 0-2.130374 0.118354-3.195562 0.118354zM460.397596 955.828017c6.036061 5.917707 14.202497 9.113269 22.723994 8.87656 16.332871-0.710125 32.31068-4.260749 47.578364-10.533518l207.711512-84.386501L972.397596 956.77485c10.060102 3.43227 20.475266 5.325936 31.008784 5.562644 11.598706 0 44.856218-0.710125 48.170134-68.408691l-12.663893-227.358299 152.321776-204.634304 1.301895-1.301896c15.622746-16.214517 22.60564-39.056865 19.055016-61.189089-4.142395-8.994914-27.45816-33.494221-46.513176-37.991678l-0.828479-0.236709-214.694406-57.993527L805.163199 92.789644l-0.59177-0.946833C794.156264 73.852982 775.693019 61.78086 755.099399 59.413777c-20.356912 1.656958-38.465095 13.965788-47.460009 32.429034l-0.710125 1.42025-120.366158 192.325473-162.855294 49.708738-75.628294 25.801202-1.656958 0.355063c-18.936662 4.142395-34.914471 17.042996-43.080906 34.559408-4.970874 22.60564 0.118354 46.03976 14.084143 64.621359l139.776236 177.294499-7.693019 255.644937-0.473416 2.367083c-4.024041 20.475266 0.118354 42.252427 11.361997 59.887194z"
                                    fill="#cdcdcd" p-id="12182"></path>
                                <path
                                    d="M775.811373 759.241794c73.971336-5.562644 138.947758-44.382802 176.110957-106.282016 11.243643-18.818308 20.356912-39.411928 26.984744-61.189089 2.958853-9.705039-2.603791-20.001849-12.308831-22.960703-9.823393-2.958853-20.001849 2.603791-22.960703 12.30883-5.680999 18.818308-13.610726 36.689783-23.315765 52.9043-33.967638 56.691632-93.381415 89.120666-162.973647 89.120666-69.592233 0-129.00601-32.547388-162.973648-89.120666-9.705039-16.214517-17.516412-33.967638-23.315765-52.785945-2.958853-9.705039-13.255663-15.267684-22.960703-12.308831s-15.267684 13.255663-12.30883 22.960703c6.627832 21.658807 15.622746 42.252427 26.984743 61.070735 37.163199 61.899214 102.139621 100.719371 176.110957 106.282016m227.713361-190.431808M975.001387 429.270458c-5.562644-13.018955-18.463245-21.658807-32.90245-22.01387h-5.680999c-32.784096 0-62.727693 9.823393-89.23902 20.830328-23.079057-39.648636-44.61951-66.041609-67.106796-82.492834-1.301896-1.065187-2.603791-2.130374-4.142395-3.077207-10.178456-6.509478-22.960703-7.574665-34.085991-2.8405-3.195562 1.301896-6.154415 3.077208-8.876561 5.325937-22.368932 16.096163-44.61951 43.19926-67.816921 82.256125-26.156264-10.533518-55.626445-20.120203-87.226999-20.120203h-5.562645c-14.320851 0.236708-27.221452 8.87656-32.784096 22.01387-12.782247 29.943597-17.989829 65.568192-15.14933 102.968099 0.710125 9.705039 8.758206 17.042996 18.344892 17.042996h1.420249c10.178456-0.828479 17.753121-9.586685 16.924642-19.765141-2.367083-31.482201 1.775312-60.952381 12.072122-85.333333h4.734166c30.653722 0 60.123902 11.598706 87.582062 23.434119 8.639852 3.668978 18.818308 0.355062 23.315765-7.929727 23.670828-42.489135 45.211281-70.302358 65.8049-84.978271 0.473417-0.355062 0.591771-0.828479 0.946834-1.183541l1.775312 1.420249c20.475266 14.794267 41.897365 42.725844 65.331484 85.451688 4.615811 8.403144 14.794267 11.835414 23.552473 7.929727 26.511327-11.71706 57.520111-24.262598 89.475728-24.262598h5.089228c9.705039 23.079057 13.965788 50.773925 12.427185 80.362459-0.591771 10.178456 7.219602 18.818308 17.398058 19.410079 10.060102 0.710125 18.818308-7.219602 19.410078-17.398058 2.367083-35.151179-2.958853-68.763754-15.030975-97.050393z m0 0"
                                    fill="#cdcdcd" p-id="12183"></path>
                                <path
                                    d="M560.998613 623.963014c-6.86454 0-13.610726-3.905687-16.687933-10.651872-20.120203-42.962552-20.356912-97.878872-20.356912-100.127601 0-10.178456 8.28479-18.463245 18.463245-18.463245s18.463245 8.28479 18.463246 18.463245c0 0.473417 0.236708 49.116967 16.924642 84.504855 4.379103 9.231623 0.355062 20.238558-8.876561 24.499306-2.603791 1.183541-5.207582 1.775312-7.929727 1.775312zM953.697642 623.963014c-2.603791 0-5.325936-0.591771-7.811373-1.775312-9.231623-4.379103-13.137309-15.267684-8.87656-24.499306 16.687933-35.624595 16.924642-84.031438 16.924641-84.504855 0-10.178456 8.28479-18.463245 18.463246-18.463245s18.463245 8.28479 18.463245 18.463245c0 2.367083-0.236708 57.165049-20.356911 100.127601-3.313916 6.746186-9.941748 10.651872-16.806288 10.651872zM695.803976 673.553398c-2.367083 0-4.734166-0.473417-6.86454-1.656958-50.300509-25.209431-69.710587-77.166898-70.420712-79.415626-2.958853-8.048081 1.183541-16.924642 9.231623-19.765141 8.048081-2.958853 16.924642 1.183541 19.765141 9.231622 0.236708 0.828479 16.332871 42.844198 55.271382 62.372631 7.693019 3.787332 10.770227 13.137309 6.86454 20.711974-2.722145 5.44429-8.166436 8.521498-13.847434 8.521498z"
                                    fill="#cdcdcd" p-id="12184"></path>
                                <path
                                    d="M614.139621 530.344891m-17.16135 0a17.16135 17.16135 0 1 0 34.3227 0 17.16135 17.16135 0 1 0-34.3227 0Z"
                                    fill="#cdcdcd" p-id="12185"></path>
                            </svg>
                            <span>推荐服务</span>
                        </div>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>

                </div>

                <div class="back item cursor " @click="backLogin">
                    <svg t="1665661880235" class="icon" viewBox="0 0 1024 1024" version="1.1"
                        xmlns="http://www.w3.org/2000/svg" p-id="13264" width="32" height="32">
                        <path
                            d="M496.32 939.392c-55.488 0-109.376-10.848-160.064-32.352-48.992-20.672-92.928-50.304-130.688-88.064-37.76-37.76-67.392-81.76-88.128-130.72C96 637.568 85.12 583.712 85.12 528.192c0-66.432 16.288-132.384 47.072-190.816 29.76-56.448 72.992-106.016 125.056-143.328 14.464-10.368 34.56-7.008 44.896 7.424 10.336 14.432 7.04 34.496-7.424 44.8C250.72 277.888 214.208 319.68 189.12 367.328c-26.336 49.952-39.68 104.064-39.68 160.864 0 92.672 36.096 179.808 101.632 245.312 65.504 65.536 152.608 101.632 245.248 101.632 92.608 0 179.744-36.096 245.28-101.632 65.536-65.504 101.6-152.64 101.6-245.312 0-56.736-13.312-110.944-39.68-160.864-25.088-47.616-61.632-89.44-105.632-120.992-14.432-10.304-17.792-30.368-7.424-44.8 10.368-14.432 30.432-17.824 44.864-7.424 52.096 37.312 95.392 86.88 125.12 143.328 30.816 58.432 47.104 124.384 47.104 190.816 0 55.52-10.88 109.376-32.352 160.096-20.704 48.96-50.368 92.96-88.128 130.72-37.76 37.76-81.696 67.36-130.688 88.128C605.664 928.576 551.808 939.392 496.32 939.392L496.32 939.392zM505.984 493.184c-17.76 0-32.16-14.336-32.16-32.128L473.824 80.192c0-17.728 14.4-32.16 32.16-32.16s32.192 14.432 32.192 32.16l0 380.864C538.176 478.848 523.744 493.184 505.984 493.184L505.984 493.184zM505.984 493.184"
                            p-id="13265" fill="#cdcdcd"></path>
                    </svg>
                    <span>退出</span>
                </div>

            </div>
        </transition>
    </div>


</template>

<script setup>
import { onMounted, ref, computed } from 'vue'
import { useStore } from 'vuex'
import { reqChangeUserAvatar } from "@/api";
import 'animate.css'
import Message from '@/plugins/message';
import { useRouter } from 'vue-router'
import { useUserInformation, useUserLevelColor } from '@/hooks/user/useUserInformation'

let isShow = ref(false);
let user = ref(null);
const _store = useStore();
const userInfo = computed(() => _store.state.user.userInformations);

const fileChange = (e) => {
    const formData = new FormData();
    const files = e.target.files;
    formData.append("avatar", files[0]);
    _store.dispatch('user/updateUserAvatar', formData)
    e.target.value = "";
};
const changeAvatar = () => {
    const fileObj = user.value.querySelector("#avatar");
    fileObj.click()
};
const backLogin = () => {
    localStorage.removeItem("token");
    location.reload();
};

const _router = useRouter()
const gotoPersonalCenter = () => {
    _router.push({
        name: 'myPost'
    })
}
useUserInformation()


</script>

<style lang="scss" scoped>
.avatar {
    position: relative;
    width: .7899rem;
    height: .7899rem;
    cursor: pointer;

    &:hover {
        img {
            transform: scale(1.35);
        }
    }

    img {
        position: absolute;
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
        z-index: 2022;
        transition: all 0.4s ease-in;
    }

}

.user-informations {
    padding-top: .6319rem;
    width: 4.5814rem;
    height: 6.0506rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    border-radius: .0948rem;
    border: 1px solid #eee;
    justify-content: space-between;
    box-shadow: 2px 2px 2px rgba(100, 100, 100, .05);
    position: absolute;
    left: 50%;
    top: .3949rem;
    transform: translateX(-50%);
    box-sizing: border-box;
    z-index: 2021;
    background-color: #fff;

    .cursor {
        cursor: pointer;
    }

    .item {
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
        justify-content: center;
        color: #333;

    }

    .ninck {
        min-height: .4739rem;

        h4 {
            font-size: .2686rem;
            font-family: PingFang SC0;
            color: #333;
            letter-spacing: .0395rem;


        }
    }




    .user-level {
        min-height: .4423rem;

        :deep(.n-progress.n-progress--line .n-progress-icon.n-progress-icon--as-text) {
            display: none;
        }

        .process {
            width: 60%;


        }

        span {
            font-size: .158rem;
            color: #fff;
            display: inline-block;
            width: .6319rem;
            height: .2528rem;
            line-height: .2528rem;
            background-color: #C9CCD0;
            text-align: center;
            border-radius: .158rem;
            margin: 0 .158rem;
            transform: scale(0.8);

            &:first-child {
                background-color: #7BCDEF;
            }

        }
    }

    .person-info {
        justify-content: space-around;


        div {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: .0948rem;


            span {
                font-size: .2528rem;
                font-family: PingFang SC0;
                color: black;

                &:last-child {
                    font-size: .2054rem;
                    color: gray;
                }
            }
        }
    }

    .application-class {

        flex-direction: column;

        >div {
            width: 100%;
            display: flex;
            min-height: .7899rem;
            align-items: center;
            box-sizing: border-box;
            padding: 0 .5055rem;
            transition: all 0.4s ease-in-out;

            &:hover {
                background: rgba(100, 100, 100, .08);
            }

            &:hover svg path {
                fill: gray;
            }






            .inner {
                flex: 1;

                svg {
                    width: .3791rem;
                    height: .3791rem;
                    margin-right: .079rem;
                    vertical-align: middle;
                }
            }

        }

    }

    .back {
        width: 100%;
        border-top: 1px solid #eee;
        justify-content: flex-start;
        gap: .2528rem;
        min-height: .8847rem;
        box-sizing: border-box;
        padding-left: .5055rem;
        transition: all 0.4s ease-in-out;

        &:hover {
            background: rgba(100, 100, 100, .08);
        }

        &:hover svg path {
            fill: gray;
        }



        svg {
            width: .3791rem;
            height: .3791rem;
            vertical-align: middle;

        }
    }
}
</style>